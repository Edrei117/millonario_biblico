# Genera el APK de la app Kivy en la nube (sin necesidad de Linux en tu PC).
# Uso: sube el proyecto a GitHub, ejecuta este workflow y descarga el APK desde "Actions".

name: Build APK (Kivy)

on:
  workflow_dispatch:   # Ejecutar manualmente desde la pestaÃ±a Actions
  push:
    branches: [ main ]
    paths-ignore:
      - '**.md'
      - '.gitignore'

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 90

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Instalar dependencias del sistema
        run: |
          sudo apt-get update
          sudo apt-get install -y pipx python3-venv build-essential openjdk-17-jdk unzip libffi-dev libssl-dev
          pipx ensurepath
          echo "$HOME/.local/bin" >> $GITHUB_PATH
          echo "HOME=$HOME" >> $GITHUB_ENV

      - name: Instalar Buildozer
        run: |
          $HOME/.local/bin/pipx install buildozer
          echo "PATH=$HOME/.local/bin:$PATH" >> $GITHUB_ENV

      - name: Generar APK
        run: |
          export PATH="$HOME/.local/bin:$PATH"
          buildozer android debug

      - name: Subir APK
        uses: actions/upload-artifact@v4
        with:
          name: apk-millonario-biblico
          path: bin/*.apk
